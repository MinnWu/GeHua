<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>格华智能数字交易系统</title>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <style>
        body {
            background: rgb(182, 233, 186);
            margin-top: 15px;
            margin-bottom: 15px;
            margin-left: 15px;
            margin-right: 15px;
        }

        .title {
            width: 800px;
            height: 100px;
            background-color: rgba(255, 255, 255, 0.856);
            margin: 0 auto;
            border-radius: 20px 20px 20px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .large {
            width: 830px;
            margin: 0 auto;
        }

        p {
            font-size: 52px;
        }

        .welcome {
            display: block;
            text-align: center;
        }

        .product {
            display: none;
        }

        .logo {
            height: 800px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #Action {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            background-color: #1f9bd9;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        input {
            width: 760px;
            height: 100px;
            font-size: 32px;
            background-color: rgba(255, 255, 255, 0.856);
        }

        span {
            font-size: 36px;
        }

        .row {
            width: 800px;
            border-radius: 20px 20px 20px 20px;
            background-color: rgba(255, 255, 255, 0.856);
            margin: 0 auto;
        }

        .small {
            height: 180px;
            margin-top: 15px;
            margin-bottom: 15px;
            margin-left: 15px;
            margin-right: 15px;
        }

        .small div:nth-child(1) {
            height: 60px;
        }

        .small div:nth-child(2) {
            height: 120px;
        }

        .small div {
            display: flex;
            align-items: center;
        }

        .submit {
            width: 800px;
            height: 100px;
            border-radius: 20px 20px 20px 20px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            background-color: #1f9bd9;
            border-style: solid;
            align-items: center;
            color: white;
        }

        .submit span {
            font-size: 50px;
            font-weight: bold;
        }

        .fnkey {
            height: 70px;
            width: 780px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        .fnkey div {
            width: 50px;
        }

        .key {
            height: 50px;
            border-radius: 50%;
            background-color: rgb(214 190 190 / 86%);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .key a {
            font-size: 36px;
            font-weight: bold;
        }

        .prompt {
            display: none;
            border-radius: 10px 10px 10px 10px;
            background-color: rgba(255, 255, 255, 0.856);
        }

        .black_overlay {
            display: none;
            position: fixed;
            top: 0%;
            left: 0%;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1001;
        }

        .white_content {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            width: 65%;
            border: 1px solid rgb(0, 0, 0);
            background-color: white;
            z-index: 1002;
            overflow: auto;
            transform: translate(-50%, -50%);
        }

        .prompt.title {
            width: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgb(182, 233, 186);
            border-radius: 10px 10px 0px 0px;
            color: black;
            font-weight: bold;
        }

        .close {
            width: auto;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .close div {
            width: 300px;
            height: 80px;
            border-radius: 10px 10px 10px 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #1f9bd9;
            color: white;
            font-weight: bold;
        }

        #content {
            text-align: center;
        }

        #content p {
            font-size: 46px;
        }
    </style>
    <script>
        var list = ['Enter product name.', 'Start date', 'Enter start price.', 'End date', 'Enter end price', 'Enter volatility index.', 'Enter premium rate.',]
        var _product = {
            'pName': '',     //商品名称
            'startDate': '',     //起始日期
            'startPrice': '',     //初始价格
            'endDate': '',       //结束日期
            'endPrice': '',  //末期价格
            'volatility': '',    //波动率
            'PR': '',    //溢价率
        }

        //生成商品信息列表
        const productList = (obj, divele = 'list') => {
            let div, input, arr, eleObj, small, mini, span, fnkey, keyadd, keydel, a, kdiv
            eleObj = document.getElementById(divele)
            div = document.createElement('div')
            div.className = 'row'
            arr = Object.keys(obj)
            for (let index = 0; index < list.length; index++) {
                small = document.createElement('div')
                small.className = 'small'
                mini = document.createElement('div')
                span = document.createElement('span')
                span.innerHTML = list[index] + ':'
                mini.appendChild(span)
                small.appendChild(mini)
                mini = document.createElement('div')
                input = document.createElement('input')
                input.type = 'text'
                input.id = arr[index]
                mini.appendChild(input)
                small.appendChild(mini)
                div.appendChild(small)
            }
            fnkey = document.createElement('div')
            fnkey.className = 'fnkey'
            keyadd = document.createElement('div')
            keyadd.className = 'key add'
            a = document.createElement('a')
            a.innerHTML = '✚'
            keyadd.appendChild(a)
            fnkey.appendChild(keyadd)
            kdiv = document.createElement('div')
            fnkey.appendChild(kdiv)
            keydel = document.createElement('div')
            keydel.className = 'key del'
            a = document.createElement('a')
            a.innerHTML = '━'
            keydel.appendChild(a)
            fnkey.appendChild(keydel)
            div.appendChild(fnkey)
            eleObj.appendChild(div)
        }

        //增加商品信息列表
        const addElement = (obj, ele) => {
            let div, input, arr, small, mini, span, fnkey, keyadd, keydel, a, kdiv
            div = document.createElement('div')
            div.className = 'row'
            arr = Object.keys(obj)
            for (let index = 0; index < list.length; index++) {
                small = document.createElement('div')
                small.className = 'small'
                mini = document.createElement('div')
                span = document.createElement('span')
                span.innerHTML = list[index] + ':'
                mini.appendChild(span)
                small.appendChild(mini)
                mini = document.createElement('div')
                input = document.createElement('input')
                input.type = 'text'
                input.id = arr[index]
                mini.appendChild(input)
                small.appendChild(mini)
                div.appendChild(small)
            }
            fnkey = document.createElement('div')
            fnkey.className = 'fnkey'
            keyadd = document.createElement('div')
            keyadd.className = 'key add'
            a = document.createElement('a')
            a.innerHTML = '✚'
            keyadd.appendChild(a)
            fnkey.appendChild(keyadd)
            kdiv = document.createElement('div')
            fnkey.appendChild(kdiv)
            keydel = document.createElement('div')
            keydel.className = 'key del'
            a = document.createElement('a')
            a.innerHTML = '━'
            keydel.appendChild(a)
            fnkey.appendChild(keydel)
            div.appendChild(fnkey)
            ele.after(div)
        }

        //删除商品信息列表
        const delProduct = (ele) => {
            if (document.querySelectorAll('.row').length != 1) {
                ele.remove()
            } else {
                console.log('至少要保留一个商品，不可以删除完。')
            }
        }

        //获取单行商品信息列表的值，返回一个json对象
        const getValue = (index) => {
            var product = JSON.parse(JSON.stringify(_product));
            var array = document.querySelectorAll('#list .row');
            product.pName = array[index].querySelector('#pName').value;
            product.startDate = array[index].querySelector('#startDate').value;
            product.startPrice = array[index].querySelector('#startPrice').value;
            product.endDate = array[index].querySelector('#endDate').value;
            product.endPrice = array[index].querySelector('#endPrice').value;
            product.volatility = array[index].querySelector('#volatility').value;
            product.PR = array[index].querySelector('#PR').value;
            return product;
        }

        //获取所有商品列表信息行的值，返回一个json对象
        const getData = () => {
            var obj = {}
            var array = document.querySelectorAll('#list .row')
            for (let index = 0; index < array.length; index++) {
                if (array[index].querySelector('#pName').value != "") {
                    var pName = array[index].querySelector('#pName').value
                    obj[pName] = getValue(index)
                } else { return obj }
            }
            return obj;
        }

        const createSpan = (text, ele = '#content') => {
            eleObj = document.querySelector(ele)
            var div = document.createElement('div')
            var p = document.createElement('p')
            p.innerHTML = text
            div.appendChild(p)
            eleObj.appendChild(div)
        }

        // 计算规则
        const calculate = (obj) => {
            return Number(obj.startPrice) + Number(obj.endPrice)
        }
        const newLine = (array) => {
            for (let index = 0; index < array.length; index++) {
                createSpan(array[index])
            }
        }
        $(function () {
            $('#Action').on('click', function () {
                if ($('.row').length == 0) {
                    productList(_product);
                }
                $('.product').show()
                $('.welcome').hide()
            });
            $('#list').delegate('.add', 'click', function () {
                // $(this).parent() 此#add元素的父级元素
                // console.log($(this).parent().parent())
                addElement(_product, $(this).parent().parent())
            });
            $('#list').delegate('.del', 'click', function () {
                delProduct($(this).parent().parent())
            });
            $('.submit').on('click', function () {
                var db = getData()
                if (JSON.stringify(db) == "{}") {
                    console.log('空数据不能提交')
                } else {
                    var arr = Object.keys(db)
                    var val = []
                    //遍历每条记录，调用calculate函数的规则对其进行判断买还是卖
                    for (let index = 0; index < arr.length; index++) {
                        if (calculate(db[arr[index]]) > 10) {
                            val.push(arr[index] + ': 买')
                        } else {
                            val.push(arr[index] + ': 卖')
                        }
                    }
                    $('#content').empty()
                    $('.prompt').show()
                    newLine(val)
                    document.querySelector('.prompt').style.display = 'block'
                    document.querySelector('#fade').style.display = 'block'
                }
            });
            $('.close').on('click', function () {
                $('.prompt').hide()
                $('#fade').hide()
                $('#content').empty()
            })
        });
    </script>
</head>

<body>
    <div class="large welcome">
        <div class="logo">
            <p>Welcome and use GeHua</p>
        </div>
        <div id="Action">
            <p>Action</p>
        </div>
    </div>
    <div class="large product">
        <div class="title">
            <p>Product Information</p>
        </div>
        <div id="list">
        </div>
        <hr>
        <div class="submit">
            <span>Confirm</span>
        </div>
        <hr>
    </div>
    <div id="fade" class="black_overlay">
        <div class="large prompt white_content">
            <div class="prompt title">
                <span>System Message</span>
            </div>
            <div class="prompt content">
                <div id="content"></div>
            </div>
            <div class="close">
                <div>
                    <span>Close</span>
                </div>
            </div>
        </div>

    </div>
</body>


</html>